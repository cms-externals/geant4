
                       geant4-10-03-ref-05
                       ===================

Major development/fixes included since the last development tag are:

 o Reviewed G4FieldManager to revise behaviour of SetDetector(); it now
   passes the Field to the Equation, as is the natural user expectation.
 o Added adapter class G4UAdapter for interfacing G4U* wrappers with VecGeom.
   Will replace G4USolid bridge class, deprecating USolids API in favour of
   direct use of VecGeom signatures.
 o Reviewed implementation of G4Para and G4Trd, made more compact and
   performant. Additional performance improvements in G4Trap and G4Box.
 o Including DAVIS model for optical physics with reflection and the
   capability of transmitting photons based on LUTs.
 o Introduced in G4SauterGavrilaAngularDistributionusing more efficient
   algorithm of sampling using Penelope-2014 prescription; expected some
   speedup in simulation.
 o Introduced new class for the cross-section of neutrons on atomic electrons
   and new model for neutron-electron elastic scattering, useful for dark
   matter searches.
 o Added new physics-list constructor G4ThermalNeutrons for addition of
   thermal neutron scattering below 4 eV.
 o Ported compilation on gcc-7.1 and enabled support.
 o Updated to new CLHEP version 2.3.4.4.
 o Updated to data set G4RealSurface-2.1.

---------- Reference-tag 'Release Notes' -----------

(*)  Fixes included in release 10.3.p02

Summarised, the list of changes is the following:

cmake                                            cmake-V10-03-20
-----
- Do not set or modify DYLD_LIBRARY_PATH in setup scripts on macOS.
  Addressing problem report #1960.
- Added VECGEOM_DEFINITIONS and VECGEOM_EXTERNAL_INCLUDES when compiling     (*)
  with USolids/VecGeom enabled, to allow for detection of external packages
  paths from VecGeom.
- Updated to data set G4RealSurface-2.1.

event                                            event-V10-03-02
-----
- Fixed 'fallthrough' compilation warnings in case statements on gcc-7.1.    (*)

externals                                        externals-V10-03-02
---------
- clhep:
  o Updated to CLHEP-2.3.4.4: fix in HepRotation::axis() for proper treatment
    of degenerating cases.
  o Fixed compilation warnings on gcc-7.1.                                   (*)
- zlib (zlib-V10-03-01):                                                     (*)
  Disabled warning on fallthrough in case statements on gcc-7.1.

g3tog4                                           g3tog4-V10-03-00            (*)
------
- Fixed compilation warnings on gcc-7.1.

geometry
--------
- magneticfield (field-V10-03-04)
  o G4FieldManager: revised behaviour of SetDetector(); it now passes the
    Field to the Equation, as is the natural user expectation.
    The previous behaviour is possible, using extra argument 'failMode' 
    flag. Values: 0           = silent ; 
                  1 (default) = warning; 
                  2 or other  = fatal exception.
    If the field is changed for an existing, working stepper it must be
    propagated to the equation of motion.
    Note: Error reporting behaviour of SetDetector is 'soft'. It does not 
    complain by default if G4ChordFinder is not (yet) set (the default values
    of failMode is 0, i.e. quiet); if a chord-finder exists, it will still
    warn for other errors.
  o Renamed G4FieldManager::SetFieldChangesEnergy() method to
    InitialiseFieldChangesEnergy() to clarify its utility.
- management (geommng-V10-03-17):
  o Added adapter class G4UAdapter for interfacing G4U* wrappers with VecGeom.
    Will replace G4USolid bridge class, deprecating USolids API in favour of
    direct use of VecGeom signatures and removal of one extra-level of
    indirection/inheritance.
  o Renamed ambiguous name Extent() in G4VSolid to BoundingLimits().
    Modified G4ReflectedSolid accordingly. Change required in order to avoid
    signature conflict with VecGeom in G4U* wrappers.
  o Moved few key methods to be inline in G4USolid.
- solids/Boolean (geom-bool-V10-03-04):
  o Renamed ambiguous name Extent() in all shapes to BoundingLimits().
  o Fixed minor Coverity defects to G4MultiUnion.
- solids/CSG (geom-csg-V10-03-23):
  o G4Trap: some code improvements: use std::copysign(); replace division
    with multiplication by inverse value; code formatting.
    Added more strict condition for trap definition in case when YZ section
    is a rectangle. Fix in the calculation of side planes.
  o Reviewed implementation of G4Para and G4Trd, made more compact and
    performant.
  o Fix in G4CutTubs::Inside() for case where inside points were considered  (*)
    as points on surface. Addressing problem report #1973.
  o G4Box: use std::copysign() to improve performance on Linux.
    Some code formatting.
  o Renamed ambiguous name Extent() in all solids and G4U* wrappers to
    BoundingLimits().
- solids/specific (geom-specific-V10-03-06)
  o Removed potential race condition in G4VTwistSurface::AmIOnLeftSide().    (*)
    Addressing problem report #1972.
  o Renamed ambiguous name Extent() in all solids and G4U* wrappers to
    BoundingLimits().

graphics_reps                                    greps-V10-03-04
-------------
- G4Colour: added Set functions for components.

intercoms                                        intercoms-V10-03-01         (*)
---------
- Fix to G4GenericMessenger::Command::SetUnit: do not ignore setting and
  issue a warning when running sequential application built against Geant4
  libraries compiled with MT enabled.

materials                                        materials-V10-03-04
---------
- Including DAVIS model with reflection and the capability of transmitting
  photons based on LUTs.

physics_lists
-------------
- constructors/electromagnetic                   phys-ctor-em-V10-03-12
  o G4EmStandardPhysics_option3: use G4UniversalFluctuation2017
    for energy loss fluctuation of e+-, protons, anti_protons.
  o G4EmStandardPhysicsSS: use G4hCoulombScatteringModel to take into 
    account relativistic corrections
  o G4EmStandardPhysicsWVI: use G4WentzelVIRelModel and
    G4hCoulombScatteringModel to take into account relativistic corrections.
  o G4EmStandardPhysics: use RayleighScattering and LivermorePhotoElectricModel.
  o G4EmStandardPhysics_option4: set final step for all particles to 10 um
    (except for GenericIon). Note: expected to slightly slow down the
    simulation but increase accuracy of range simulation.
  o G4EmParticleList: new class with the list of particles for which EM
    processes are instantiated
  o G4EmModelActivator: fixed Opt4 and SS per region.                        (*)
- constructors/gamma_lepto_nuclear               phys-ctor-glnuclear-V10-03-01
  o G4EmExtraPhysics, G4EmMessenger, G4BertiniElectroNuclearBuilder:
    added option and UI command to enable/disable e+- nuclear process.
    Added extra UI commands to define cross-section factors for rare processes
    (requirement of ShiP experiment for dark matter search).
- constructors/hadron_elastic                    phys-ctor-helastic-V10-03-00
  o G4ThermalNeutrons: new class for addition of thermal neutron
    scattering below 4 eV (backported from CMS simulation).

processes/electromagnetic/dna                    emdna-V10-03-19
-----------------------------
- Fixed compilation warnings on gcc-7.1.                                     (*)

processes/electromagnetic/lowenergy              emlowen-V10-03-08
-----------------------------------
- G4LivermoreGammaConversionModel, G4BoldyshevTripletModel: added possibility
  of triplet production; use G4Log; code cleanup.
- G4LivermorePhotoElectricModel, G4LivermoreRayleighModel: minor code cleanup
  and optimisations.
- G4LowEPPolarizedComptonModel: fixed FPE in comptation of std::acos().      (*)
- Fixed compilation warnings on gcc-7.1.                                     (*)

processes/electromagnetic/standard               emstand-V10-03-18
----------------------------------
- G4SauterGavrilaAngularDistribution: introduced more efficient algorithm
  of sampling using Penelope-2014 prescription; expected that simulation
  will be faster.
- G4UniversalFluctuation: reverted to 10.3 version.
- G4UniversalFluctuation2017: new class including recent developments,
  Added correction in order to get better FWHM values.
- G4UniversalFluctuation, G4UniversalFluctuation2017: fixed numerical
  problem for very small steps for all particle types.
- G4UniversalFluctuation, G4UniversalFluctuation2017: fixed numerical        (*)
  problem for sampling low-energy anti-protons with very small steps
- G4BetheHeitlerModel, G4PairProductionRelModel: minor change in angular
  sampling.
- G4WentzelVIRelModel: fixed typo responsible for numerical crash.
- G4BetheHeitlerModel, G4PairProductionRelModel: code cleanup and 
  optimisations; replaced remaining use of log, exp with G4Log and G4Exp.
- G4eBremsstrahlungRelModel: use new interface to triplet model.
  Added class members and cross-sections for sampling of electron recoil.
- G4WentzelOKandVIxSection, G4eCoulombScatteringModel, 
  G4WentzelVIModel, G4hCoulombScatteringModel: code and interface cleanup.
  G4WentzelVIRelModel: use inheritance from G4WentzelVIModel.
  G4WentzelVIRelXSection: use inheritance from G4WentzelOKandVIxSection.

processes/electromagnetic/utils                  emutils-V10-03-10
-------------------------------
- G4VEmModel: added triplet model pointer and Get/Set methods.
- G4VEmProcess: added DNA ionisation process for hydrogen and helium
  to the list of processes, which have auger and fluo flags.
- G4VEnergyLossProcess, G4LossTableManager: minor cleanup of inline methods.
- Fixed typo in G4EmSaturation.                                              (*)

processes/hadronic
------------------
- cross_sections (hadr-cross-V10-03-07)
  o G4NeutronElectronElXsc: new class for the cross-section of neutrons on
    atomic electrons. Ultra-relativistic approximation of the Rosenbluth
    formula is used, as more relevant for detector applications. In particular,
    for dark matter searches, this process can produce electrons with high
    energy, if there are high energy neutrons (more than 10 GeV).
  o G4NeutrinoElectronNcXsc, G4NeutrinoElectronCcXsc, G4NeutronElectronElXsc :
    added possibility of biasing these cross-sections.
- management (hadr-man-V10-03-03)
  o G4HadronicProcess: correctly check charge and energy balance in the case
    of e- internal conversion; improved initialisation for constructors.
- models/binary_cascade (had-binary-V10-03-03)
  o Setting creator model for particles it creates; pass through time info.
- models/cascade (hadr-casc-V10-03-02)
  o G4ElementaryParticleCollider::generateSCMmuonAbsorption: fixed case of rare
    segmentation-fault. Added clearing of particles if GetThreeBodyMomenta()
    returns no momenta.
- models/coherent_elastic (hadr-cohe-V10-03-03)
  o G4NeutronElectronElModel: new model for neutron-electron elastic
    scattering. It produces recoil electrons resulting in visible energy
    deposition. The model is based on ultra-relativistic approximation of the
    Rosenbluth formula, since recoil electrons will have enough energy
    to be detected in the case of high energy neutrons, roughly > 1 GeV.
  o G4NeutrinoElectronNcModel: fixed bug on the Plab calculation in the
    ApplyYourself() method.
- models/de_excitation (hadr-deex-V10-03-34)
  o G4PolarizationTransition: GenerateGammaCosTheta() and GenerateGammaPhi(),
    added warning when polarization entries are empty and return isotropic
    random in that case. Fixes rare crash.
    Added Jason warning of zero coefficient.
  o G4ExcitationHandler, G4DeexPrecoParameters: define index of e- internal
    conversion and propagate it to reaction products
  o G4ExcitationHandler, G4NeutronRadCapture: propagate index of e- internal
    conversion to base class G4HadronicProcess.
- models/lend (hadr-lend-V10-03-03)                                          (*)
  o Fixed compilation warnings on gcc-7.1.
- models/radioactive_decay (radioactive_decay-V10-03-07)
  o G4RadioactiveDecay: instantiate G4PhotonEvaporation in constructor and
    pass pointer to G4ITDecay. Removed instantiation of G4PhotonEvaporation
    G4ITDecay.
- models/theo_high_energy (had-theo-HE-V10-03-01)
  o G4TheoFSGenerator: pass through creator model and time.
- models/util (hadr-mod-util-V10-03-04)                                      (*)
  o G4Fragment: fixed destructor and printout.
  o G4PolynomialPDF: fix for potential division by zero.

processes/optical                                op-V10-03-02
-----------------
- Including DAVIS model with reflection and capability of transmitting
  photons based on LUTs. Requires new data set G4RealSurface-2.1.

processes/solidstate/channeling                  channeling-V10-03-00
-------------------------------
- Removed spin modification.

run                                              run-V10-03-11
---
- Prevent adding multiple times the same sensitive-detector to the same
  logical volume via G4VUserDetectorConsturction::SetSensitiveDetector().
  In case skip and issue a warning.

visualization                                    vis-V10-03-05
-------------
- management (visman-V10-03-12):
  o Fix to "/vis/viewer/interpolate" for file writing viewers.
  o Added G4VVisCommand::ConvertToColour. Now used throughout vis commands.
  o Added G4VVisCommand::ConvertToColourGuidance. This avoids having to
    repeat it for every command that uses it.
  o "/vis/viewer/save": added .g4view if an extension is not supplied by
    the user.
  o "/vis/viewer/set/defaultTextColour": changed default to blue and opaque
    to agree with default text vis attributes.
  o Add user-selected colour to "/vis/scene/add/gps".
- modeling (modeling-V10-03-07):
  o Completed G4GPSModel for visualisation of General Particle Source.
    Can be used with the UI command "/vis/scene/add/gps".
    Added user-selectable colour.
- FukuiRenderer (DAWN-V10-03-00):                                            (*)
  o Expand filename numbering to 4 digits.
    You may need:
       export G4DAWNFILE_MAX_FILE_NUM=9999
    or setenv G4DAWNFILE_MAX_FILE_NUM 9999
    Useful if producing many files for a movie.
- gMocren (gMocren-V10-03-00):                                               (*)
- HepRep (vis-HepRep-V10-03-00):                                             (*)
  o Fixed compilation warning on gcc-7.1.
- OpenGL (opengl-V10-03-02):
  o Fixed picking on MacOS, which was not working for retina display
    due to a screen factor *2.
  o Fixed compilation warning on gcc-7.1.                                    (*)
- RayTracer (raytracer-V10-03-04):
  o Expand filename numbering to 4 digits.
    Useful for producing many files for a movie.
- VRML (VRML-V10-03-01):                                                     (*)
  o Fixed compilation warning on gcc-7.1.
- externals (visexternal-V10-03-00):                                         (*)
  o Fixed compilation warning on gcc-7.1 in gl2ps.

data sets:
---------
- G4RealSurface-2.1:
  o Updated and more compact LUT data.

examples                                         examples-V10-03-05
--------
- Updated documentation and reference outputs.
- advanced/composite_calorimeter (ccal-V10-03-00)                            (*)
  o Fixed compilation warning on gcc-7.1.
- advanced/hadrontherapy (hadrontherapy-V10-03-06)
  o RippleFilter geometry on PassiveCarbonBeamLine.
  o Added TIFPA beam line.
  o Removed SetCuts() method from PhysicsList.
- advanced/medical_linac (medical_linac-V10-03-00)                           (*)
  o Fixed compilation warnings on gcc-7.1.
- extended/electromagnetic/TestEm5 (testem5-V10-03-05)
  o Added DNA constructors in PhysicsList.
  o Added DNA histograms in HistoManager.
  o Added new flags in StackingAction.
  o Update of README.
- extended/electromagnetic/TestEm7 (testem7-V10-03-00)                       (*)
  o Fixed compilation warnings on gcc-7.1.
- extended/exoticphysics/channeling (channelingExample-V10-03-01)
  o Added support for G4Crystal.
  o Added support for G4Channeling process.
- extended/exoticphysics/dmparticle (dmparticle-V10-03-03)
  o Simplified example for light dark matter (LDM) particles. 
    It consists of LDM Bremsstrahlung process for protons creating
    G4LDMPhotons. The latter decays creating G4LDMHi and G4LDMHiBar LDM
    scalar particles. They can scatter on nucleons and electrons. 
    The first version has electromagnetic processes only.
    Hadron constructors can be added similarly to hadronic examples.
- extended/field/field01 (fieldex01-V10-03-00)
  o Fixed Valgrind error in F01FieldSetup::CreateStepperAndChordFinder()
    method; first delete all dependent objects, then create new ones.
- extended/field/field02 (fieldex02-V10-03-02)
  o Fixed F02ElectricFieldSetup::Update() method. Now all old objects are
    deleted first, and then new ones are created; renamed UpdateStepper()
    to UpdateIntegrator() to clarify its role.
- extended/field/field03 (fieldex03-V10-03-00)
  o Fixed Valgrind errors in field setup's update method; first delete all
    dependent objects, then create new ones.
- extended/medical/dna/icsd (exicsd-V10-03-01)
  o New example for Ionisation Cluster Size Distribution. Allows the
    calculation of the distribution concerning the number of ionisations
    per event in an small cylinder of nanometers scale, typical dimensions
    of a 10 base pairs piece of chromatin. First use of new DNA-like
    material's cross-sections experimentally obtained at PTB
    (Rad. Phys and Chem. 130 (2017) 459-479) for electrons and calculated
    for protons on THF, TMP, PY and PU materials.
- extended/optical/LXe (LXe-V10-03-00)                                       (*)
  o Fix for issue reported on Hypernews Optical-Photons Forum #651.
- extended/optical/OpNovice (OpNovice-V10-03-01)
  o Exercising new DAVIS LUT surface model.
- extended/optical/wls (WLS-V10-03-00)                                       (*)
  o Fixed compilation warnings on gcc-7.1.
- extended/radioactivedecay (exRadioactivedecay-V10-03-00)
  o Added new example "Activation", for survey og the energy deposition
    and particle's flux from a hadronic cascade.
- extended/runAndEvent/RE05 (exampleRE05-V10-03-00)                          (*)
  o Fixed potential rare race condition issue in RE05PrimaryGeneratorAction.

tests                                            tests-V10-03-05
-----
- Updated reference outputs and tools.
- tests/test37 (test37-V10-03-00)
- tests/test41 (test41-V10-03-00)
- tests/test44 (test44-V10-03-00)
  o Extended CMake script.
- tests/test54 (test54-V10-03-02)
- tests/test55 (test55-V10-03-00)
- tests/test56 (test56-V10-03-00)
  o Ported to multi-threading and use of g4tools for analysis.
