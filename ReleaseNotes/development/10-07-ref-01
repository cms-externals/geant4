
                       geant4-10-07-ref-01
                       ===================

Major development/fixes included since the last development tag are:

 o Extending cylindrical scoring mesh to tube and tube segment.
 o Introduced flag and access functions for LastCommandOutputTreated.
 o Updates to G4GammaGeneralProcess: exclude gamma-nuclear from the 2nd
   energy area.
 o Corrected way to count the number of events processed in a worker thread
   when using G4TaskRunManager.
 o Removed deprecated functions in visualization.
 o New data set: G4EMLOW-7.14.

---------- Reference-tag 'Release Notes' -----------

(*)  Fixes included in release 10.7.p01

Summarised, the list of changes is the following:

cmake                                            cmake-V10-07-04
-----
- Make fail configuration if Qt is enabled with CMake < 3.9.                 (*)
  Addressing problem report #2303.
- Fixed potential installation error with Homebrew/MacPorts X11/GL.          (*)
  Apply GitHub PR #17 from Florian Uhlig.
- Fixed configure/build with system PTL 1.0.0.                               (*)
  Apply GitHub PR #16 from andriish.
- Install/Use builtin PTL CMake scripts from PTL subdirectory alongside      (*)
  Geant4Config.cmake.
- Updated to data set G4EMLOW-7.14.

config                                           config-V10-07-00            (*)
------
- Updated Qt5 settings in Linux targets.

analysis                                         analysis-V10-07-00          (*)
--------
- Updated to g4tools 5.2.3:
  o Fixed bug in tools/histo/h2,h3 for get_bin_content(); have '&' in "get"
    arguments. Addressing problem report #2306.
  o See History_tools for the complete list of modifications.

digits_hits
-----------
- utils (detutils-V10-07-00)
  o Extending cylindrical scoring mesh to tube and tube segment.

externals                                        externals-V10-07-00         (*)
---------
- Force PTL to install its CMake configuration files within the directory
  where Geant4 installs its own. Force to install its headers under
  CMAKE_INSTALL_INCLUDEDIR/Geant4. Addressing problem report #2298.
- ptl (ptl-V10-07-01):                                                       (*)
  o Apply patch to fix component installs on Windows.

geometry/navigation                              geomnav-V10-07-01           (*)
-------------------
- G4ReplicaNavigation: reduced step correction in ComputeStep().
  Addressing problem report #2302.
- G4PathFinder: moved debug printout within debug block in Locate().
- G4RegularNavigation: protected within G4DEBUG_NAVIGATION debug printout.
  Substituted warning printout with proper G4Exception.

geometry/solids/Boolean                          geom-bool-V10-07-00         (*)
-----------------------
- Added protection against using invalid normal
  in G4ScaledSolid::DistanceToOut(p,v).

geometry/solids/specific                         geom-specific-V10-07-00     (*)
------------------------
- Reduce cases of bad speculation in G4PolyhedraSide::Inside() and
  G4PolyPhiFace::InsideEdges(), based on profiling analysis.

geometry/volumes                                 geomvol-V10-07-01           (*)
----------------
- Added creation order index in G4LogicalBorderSurface.
  Addressing problem report #2311.
- G4GeometryWorkspace: added protection for thread contention in function
  DestroyWorkspace(). Some code cleanup.

global                                           global-V10-07-00
------
- Updated date and tag-ID for geant4-10-07-ref-01.

graphics_reps                                    greps-V10-07-00
-------------
- Remove deprecated G4VisAttributes::Invisible.

intercoms                                        intercoms-V10-07-00         (*)
---------
- G4UImanager:
  o Introduced flag and access functions for LastCommandOutputTreated.
    This flag is set to false at the point in ApplyCommand() where, if
    verbosity>0, the command is sent to G4cout.
    The treating UI must reset to true when the line has been treated.
    Of course, the UI may simply ignore it.

interfaces                                       interfaces-V10-07-03        (*)
----------
- G4UIQt: Use QPalette to get colour and background from OS;
  instead of fixed background <span style='background:#EEEEEE...
  use <span style='background:" + pal.highlight().color().name()...
  This picks up colour from the OS and even allows for change of
  OS display style, e.g., dark mode on MacOS.
  Fixed command-line-echo highlighting whereby there could be a crash
  in some circumstances: use <span> instead of <div> in HTML wrappers.
- Introduce choice of output styles:
  o /gui/outputStyle
    <cout|cerr|warnings|errors|all>
    <fixed|proportional>
    <highlight|no-highlight>
  o Highlighting applies to the echoed command line if echoing is
    requested with /control/verbose > 0.

persistency/gdml                                 gdml-V10-07-00              (*)
----------------
- Fix for proper treatment of material properties reading for skinsurface
  and bordersurface elements; adopt the key of the property vector map as
  'name + ref'. Addressing problem report #2305.

physics_lists
-------------
- builders (phys-builders-V10-07-01)                                         (*)
  o G4HadronicBuilder: replaced 2-body decays of bottom mesons into charmed
    mesons and charged rho resonance, with 3-body decays into the same charmed
    mesons and charged pion and neutral pion. This allows to get a more precise
    numerical treatment of the decay kinematics in the rest frame, avoiding
    spurious energy-momentum violations reported by G4DecayProducts.
  o OrderingParameterTable: added forgotten processes (general positron,
    surface reflection, DNA) coherently with G4PhysicsListHelper.
- constructors/electromagnetic (phys-ctor-em-V10-07-01)
  o G4GammaGeneralProcess: changed 1st energy limit from 50 keV to 150 keV   (*)
    to guarantee K-shell energy for any element to be within 1st energy area.
    Changed logic for selection of a concrete process. Maximally reduced 
    use of 'if' statements; reduced number of 'return' in run time methods;
    removed shadowing of base class methods.
    Addressing problem report #2309.
  o G4GammaGeneralProcess: exclude gamma-nuclear from the 2nd energy area,
    because cross-section is zero; in the 4th energy interval include in the
    vector value of 1 - p instead of p, where p is the cumulative probability
    of a sub-process.
- constructors/hadron_elastic (phys-ctor-helastic-V10-07-01)
  o G4HadronElasticPhysics: fixed type of builder in all hadron elastic      (*)
    constructors. Addressing problem report #2183.
  o G4IonElasticPhysics, G4ThermalNeutrons: added comments.                  (*)
  o G4HadronDElasticPhysics, G4HadronHElasticPhysics: use inheritance from
    G4HadronElasticPhysics; use G4HadProcesses, G4PhysListUtil and
    G4HadParticles; implement cross-section factor.
- constructors/hadron_inelastic (phys-ctor-hinelastic-V10-07-00)             (*)
  o G4HadronPhysicsFTFP_BERT, G4HadronPhysicsQGSP_BERT, G4HadronInelasticQBBC,
    G4HadronPhysicsQGSP_BIC: fixed type of builder in all hadron inelatic
    constructors. Addressing problem report #2296.

processes/electromagnetic/lowenergy              emlowen-V10-07-00           (*)
-----------------------------------
- G4MicroElecSurface, G4MicroElecLOPhononModel: fixed trivial Coverity defect
  warnings.

processes/electromagnetic/standard               emstand-V10-07-00           (*)
----------------------------------
- G4BetheBlochModel, G4LindhardSorensenIonModel: restore computation of
  maximum energy transfer as in Geant4 version 10.4; affecting only
  ultra-relativistic ions. Addressing problem report #2312.

processes/electromagnetic/utils                  emutils-V10-07-00           (*)
-------------------------------
- G4EmCorrections: fixed 2-D interpolation of shell corrections, which provides
  minor change of ranges of charge particles (< 0.1 mm).
  Addressing problem report #2308.

processes/hadronic
------------------
- cross_sections (hadr-cross-V10-07-03)                                      (*)
  o Drop cache for per-element G4CrossSectionDataStore::GetCrossSection(),
    as never used in practice. Note that material, particle, and energy are
    still cached by G4CrossSectionDataStore::ComputeCrossSection(). The
    condition to check for the cache in that case has been optimized to
    minimize unnecessary checks by reordering checked conditions from most
    to least discriminant.
  o G4ParticleInelasticXS, G4CrossSectionInelastic, G4CrossSectionElastic:
    extended maximum energy range for ion cross-sections (QBBC and other
    Physics Lists has the same high energy limits).
  o G4ParticleInelasticXS, G4NeutronCaptureXS, G4NeutronElasticXS,
    G4NeutronInelasticXS: make MAXZ variable static class member.
  o G4GammaNuclearXS: fixed duplicated name of static variable.
  o G4VCrossSectionRatio: use inheritance from G4VCrossSectionDataSet
    in order to guarantee deletion of the object at the end of run.
- models/particle_hp (hadr-hpp-V10-07-00)                                    (*)
  o G4ParticleHPThermalScattering: added final state phi-rotation.
    Addressing problem reports #1856 and #2290.
- stopping (hadr-stopping-V10-07-00)                                         (*)
  o G4MuonicAtomDecay: fixed Coverity defect warning; removed commented code.

processes/transportation                         transport-V10-07-00         (*)
------------------------
- Limit reporting of number of calls to G4Transportation::AlongStepDoIt()
  to when either G4VERBOSE or G4DEBUG_TRANSPORT is defined, which allows to
  avoid using a thread local variable for a slight performance gain.

run                                              run-V10-07-00               (*)
---
- G4PhysicsListHelper: added forgotten processes (general positron and
  surface reflection).

tasking                                          tasking-V10-07-00           (*)
-------
- G4WorkerTaskRunManager: corrected way to count the number of events processed
  in a worker thread. This correction also fixes a rare crash due to accessing
  to the seed vector more than necessary.
- G4TaskRunManager: reduce number of events per task to evenly distribute
  events to all available threads.

tracking                                         tracking-V10-07-00
--------
- Avoid unnecessary indirections when checking for regional stepping
  action by reusing the value of current volume in stepping manager.

visualization                                    vis-V10-07-01
-------------
- management (visman-V10-07-01):
  o Removed deprecated G4VisManager::SetUserAction().
    Use RegisterRunDurationUserVisAction or similar instead. These functions
    represent quite an advanced use of visualisation and are rarely used.
  o "/vis/set/extentForField", "/vis/scene/add/electricField" and magneticField:
    improved guidance to take note of change to G4VFieldModel, namely that the
    number of data points is now calculated on the basis of the extent, which
    can be set as above.
- modeling (modeling-V10-07-01):
  o G4VFieldModel: Change concept of choice of data points: this model simply
    checked that a data point was within the extent. Now it uses the extent
    to determine the datapoint spacing.
    Note: if 'fExtentForField' is null, the used extent is that of the current
    scene; otherwise it uses that supplied by the user.
  o G4PhysicalVolumeModel: simplify validation.
- OpenGL (opengl-V10-07-01):
  o Removed deprecated "/vis/ogl/set/" commands.
  o All commands connected with a time window. Use equivalent
    "/vis/viewer/set/timeWindow" commands.
  o "/vis/ogl/set/eventsDrawInterval <N>" is replaced by 
    "/vis/ogl/flushAt NthPrimitive <N>".
- OpenInventor (openinventor-V10-07-01):                                     (*)
  o Consolidated all the planned features of the OIQt viewer.
- Qt3D (visQt3D-V10-07-00):                                                  (*)
  o Auxiliary edge suppression and some small improvements.

data sets:
---------
- G4EMLOW-7.14:
  o Removed tabs in option4 cross-section files.

examples                                         examples-V10-07-01
--------
- Updated documentation and reference outputs.
- advanced/doiPET (doiPET-V10-07-00)
  o Replace deprecated G4VisAttributes::Invisible by
    G4VisAttributes::GetInvisible().
- advanced/hadrontherapy (hadrontherapy-V10-07-02)
  o Modified HadrontherapyLet for file generation.
  o Geometry modification in CarbonBeamLine.
  o Minor changes in macro files.
  o Replace deprecated G4VisAttributes::Invisible by
    G4VisAttributes::GetInvisible().
- basic/B4 (exampleB4-V10-07-00)                                             (*)
  o Fixed README: updated VISUALIZATION TUTORIAL to follow smart parsing.
- extended/electromagnetic/TestEm0 (testem0-V10-07-00)
  o Updated PhysListEmStandard.
  o DetectorConstruction: print only used material.
- extended/electromagnetic/TestEm1 (testem1-V10-07-00)
  o Updated PhysListEmStandard.
  o DetectorConstruction: do not print materials table.
  o StepMax: code formatting.
  o Added macro stepMax.mac.
- extended/electromagnetic/TestEm2 (testem2-V10-07-00)
  o Updated PhysListEmStandard.
  o DetectorConstruction: do not print materials table.
  o StepMax, StepMaxMessenger, PhysicsList, PhysicsListMessenger: revert,
    to make command '/testem/stepMax' working in interactive mode.
  o Added macro stepMax.mac.
- extended/electromagnetic/TestEm3 (testem3-V10-07-00)
  o Updated PhysListEmStandard.
  o StepMax, StepMaxMessenger, PhysicsList, PhysicsListMessenger: revert,
    to make command '/testem/stepMax' working in interactive mode.
  o Added macro stepMax.mac.
- extended/electromagnetic/TestEm5 (testem5-V10-07-00)
  o Updated PhysListEmStandard.
  o TrackingAction: fixed bug for filling histos 6 and 7.
  o StepMax, StepMaxMessenger, PhysicsList, PhysicsListMessenger: revert,
    to make command '/testem/stepMax' working in interactive mode.
  o Added macro stepMax.mac.
- extended/electromagnetic/TestEm9 (testem9-V10-07-00)
  o Replaced local Physics List by clone of the default EM standard; recover
    analysis of process calls for the case of gamma general process; improved
    macro files.
- extended/electromagnetic/TestEm11 (testem11-V10-07-00)
  o Updated PhysListEmStandard.
  o DetectorConstruction: print only used material.
  o RunAction: dump G4EmParameters.
- extended/electromagnetic/TestEm12 (testem12-V10-07-00)
  o Updated PhysListEmStandard.
- extended/hadronic/Hadr03 (exhadr03-V10-07-00)
  o PhysicsList: added GammaNuclearPhysicsLEND.
- extended/hadronic/Hadr06 (exhadr06-V10-07-03)
  o TrackingAction: count secondary particles with meanLife > 0. Print meanLife.
  o PhysicsList: added GammaNuclearPhysicsLEND.
  o Updated ElectromagneticPhysics.
  o Suppressed command "/process/list" in several macros.
- extended/hadronic/Hadr07 (exhadr07-V10-07-02)
- extended/hadronic/NeutronSource (NeutronSource-V10-07-02)
  o TrackingAction: count secondary particles with meanLife > 0.
  o PhysicsList: added GammaNuclearPhysicsLEND.
  o Updated ElectromagneticPhysics.
- extended/medical/DICOM (DICOM-V10-07-00)
- extended/medical/dna/chem2 (chem2-V10-07-00)
  o In vis.mac, changed "/vis/ogl/set/eventsDrawInterval" to
    "/vis/ogl/flushAt NthPrimitive".
- extended/medical/dna/chem3 (chem3-V10-07-00)
- extended/medical/dna/neuron (neuron-V10-07-00)
  o In vis.mac, changed "/vis/ogl/set/" to "/vis/viewer/set/timeWindow/".
- extended/persistency/gdml/G01 (G01-V10-07-00)                              (*)
  o Added scaledSolids.gdml sample setup.
- extended/radioactivedecay/Activation (activation-V10-07-02)
  o TrackingAction: count secondary particles with meanLife > 0.
  o PhysicsList: added GammaNuclearPhysicsLEND.
  o Updated ElectromagneticPhysics.

tests                                            tests-V10-07-01
-----
- Updated reference outputs and tools.
- tests/test22 (test22-V10-07-00)
  o Updated files to be coherent with test30.
    Main modification: cross-sections from FTFP_BERT.
- tests/test30 (test30-V10-07-01)
  o In main(), use G4ParticleInelasticXS for gamma and light ions.
    Removed unused headers, use cross-sections from FTFP_BERT.
- tests/test35 (test35-V10-07-00)
  o In main(), updated cross-sections, printouts and code clean-up.
  o Test30Physics: clean-up according to recent changes in hadronics;
    qgsp, qgsb, ftfp, ftfb definitions included; ion models removed.
  o Removed HsQGSBInterface and HsQGSPInterface.
- tests/test45 (test45-V10-07-00)
  o Updated for release 10.7.
- tests/test46 (test46-V10-07-00)
  o In main(), use factory to define RunManager; use 3rd argument in 
    batch mode to define name of PhysicsList; disabled visualisation in
    batch mode.
  o DetectorConstruction: define geometry sizes only at PreInit state.
  o HistoManager: allow modification of histograms via UI commands.
  o Removed obsolete UI commands and fixed others.
