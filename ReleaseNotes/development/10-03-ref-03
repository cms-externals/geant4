
                       geant4-10-03-ref-03
                       ===================

Major development/fixes included since the last development tag are:

 o Cleaned up destruction of allocated data at initialisation for
   split-classes in geometry and particles. Automatically deallocate
   thread-local singletons in geometry.
 o Updated particle properties according to PDG-2016.
 o Added DAVIS model for optical physics.
 o G4UniversalFluctuation: correction in order to get better E_mp and 
   FWHM in the case of small steps.
 o Fixed schema for replicas along angular axis. Updated GDML schema
   to version 3.1.5.
 o New extended examples for G4DNA.
 o Updated to data sets G4RealSurface-2.0.

---------- Reference-tag 'Release Notes' -----------

(*)  Fixes included in release 10.3.p02

Summarised, the list of changes is the following:

cmake                                            cmake-V10-03-14
-----
- Updated to data set G4RealSurface-2.0.

config                                           config-V10-03-00            (*)
------
- Corrected order of linkage in binmake.gmk for analysis global library.

analysis                                         analysis-V10-03-02          (*)
--------
- Fixed problem of removing non-empty ntuple files in user application
  where ntuples are created after open file.
- Added GetP[1,2]Id(const G4String&) functions to G4AnaysisManager.
  Addressing problem report #1949.

geometry
--------
- biasing (geombias-V10-03-00)                                               (*)
  o Added mutex locks to methods within G4IStore and G4ImportanceAlgorithm.
    Temporary fix for erratic behaviour in MT-mode and crashing if bounds-
    checking is switched on with many threads/events.
    Addressing problem report #1945.
- divisions (geomdiv-V10-03-00)
  o Fix to unit test.
- magneticfield (field-V10-03-01)
  o Corrected destructor in G4FieldManagerStore and added simple accessor
    to return singleton pointer.
- management (geommng-V10-03-13):
  o Fixed static memory leak from G4LogicalVolume, G4VPhysicalVolume and
    G4Region, for offsets allocated at initialisation.
  o Removed additional wrong lock in G4GeomSplitter for function
    SlaveReCopySubInstanceArray().
  o Added simple accessor to return singleton pointer for G4GeometryManager.
    Define IsGeometryClosed() as a static method, to avoid call to
    GetInstance(). Made related Boolean flag thread-local.
  o Enabled deletion of solids in G4SolidsStore destructor also for MT mode.
- navigation (geomnav-V10-03-04):
  o Correction in destructors of G4TransportationManager and G4PathFinder.
    Avoid eletion of field-manager pointer in destructor of
    G4TransportationManager, as it is being deleted by G4FieldManagerStore.
    Added simple accessor to return singleton pointer for G4PathFinder and
    G4TransportationManager.
- solids/CSG (geom-csg-V10-03-06):
  o Fixed possible rounding off error in calculation of 'astep' (max angle   (*)
    for one step) in CalculateExtent() for G4Cons, G4Tubs, G4CutTubs
    and related USolids wrappers.
  o G4Trap: modified computation of side planes; bounding box/envelope
    are computed directly from side planes. Added CheckParameters() and
    MakePlanes(pt), simplified constructors and SetAllParameters().
    In G4UTrap, bounding box/envelope are computed directly from side planes
    as for G4Trap. Increased tolerance in the check of consistency of
    bounding boxes in Extent().
- solids/specific (geom-specific-V10-03-03)
  o Fixed possible rounding off error in calculation of 'astep' (max angle   (*)
    for one step) in CalculateExtent() for G4Polycone, G4GenericPolycone
    and related USolids wrappers.
  o G4SolidsWorkspacePool: implemented CleanUpAndDestroyAllWorkspaces(),
    to be called by worker threads. Removed declaration (i.e. not implemented)
    of protected method ReleaseAndDestroyWorkspace().
- volumes(geomvol-V10-03-01):
  o G4GeometryWorkspacePool: implemented CleanUpAndDestroyAllWorkspaces(),
    to be called by worker threads. Removed declaration (i.e. not implemented)
    of protected method ReleaseAndDestroyWorkspace().

global                                           global-V10-03-02
------
- G4TWorkspacePool: implemented CleanUpAndDestroyAllWorkspaces(),
  and Recycle() to be called by worker threads.
- Fix in destructor of G4ThreadLocalSingleton to destroy mutex as last       (*)
  action. Fixes contention reported by Valgrind/DRD.

materials                                        materials-V10-03-03
---------
- Added DAVIS model for optical surfaces.

particles                                        particles-V10-03-07
---------
- Updated particle properties according to PDG-2016.
- Fixed leak at construction for data allocated through G4ParticleDefinition
  for the sub-instance offset in the splitter. Added static method Clean() to
  G4ParticleDefinition, called as last in the destructor of G4ParticleTable.
- Fixed Coverity defects.

persistency/gdml                                 gdml-V10-03-00
----------------
- Fixed schema for replicas along angular axis.
  Updated GDML schema to version 3.1.5.
  Addressing problem report #1917.
- Added possibility to specify material properties tables for optical
  surfaces (Wouter Deconinck). Addressing enhancement request #1947.

physics_lists
-------------
- constructors/decay                             phys-ctor-decay-V10-03-02
  o G4RadioactiveDecayPhysics: set time limit for the de-excitation module
    the same as in G4NuclideTable, so only states from this table will
    be created as ions.
- lists                                          phys-lists-V10-03-01
  o Fixed problem in LBE physics-list for radio-active decay model.

processes/biasing                                procbiasing-V10-03-01       (*)
-----------------
- G4GeometrySampler: removed unnecessary ClearSampling() from the destructor.

processes/electromagnetic/dna                    emdna-V10-03-12
-----------------------------
- Introducing G4PhysChemIO class.
- Moved call to G4TrackList::Pop(track) from G4ITTrackingManager
  to G4ITTrackHolder and make sure track status is set to fStopAndKill
  when G4ITTrackHolder::PushToKill is called.
- G4DNAMolecularMaterial: removed newly introduced methods; added fatal
  exception if used. Added doxygen documentation.

processes/electromagnetic/muons                  emmuons-V10-03-00
-------------------------------
- G4MuBremmstrahlungModel, G4MuPairProductionModel: make all data members
  protected, allowing to reuse these classes as base for dark matter photons.

processes/electromagnetic/standard               emstand-V10-03-04
----------------------------------
- G4hIonisation: fixed min/max energy for dEdx table for the case when the   (*)
  mass of a hadron is very different from the mass of proton.
- G4UniversalFluctuation: correction in order to get better E_mp and 
  FWHM in the case of small steps.
- G4PairProductionRelModel: fixed inconsistency in calculating the LPM
  suppression for the pair-production model.
- G4WentzelOKandVIxSection, G4WentzelVIRelXSection: added "ScreeningFactor"
  parameter to study accuracy of scattering models.

processes/electromagnetic/utils                  emutils-V10-03-02
-------------------------------
- G4EmParametersMessenger, G4EmParameters: added parameter "ScreeningFactor",
  related modifiers and UI command.

processes/hadronic
------------------
- models/abrasion (had-abrasion-V10-03-00)
  o G4WilsonAbrasionModel: removed dependence on G4FermiBreakUp, G4Evaporation,
    and G4MultiFragmentation; not needed redefinition of default objects.
- models/de_excitation (hadr-deex-V10-03-23)
  o G4ExcitationHandler, fermi_breakup, photon_evaporation modules: 
    removed obsolete FermiBreakUp model and corresponding classes
  o G4LevelReader: issue fatal exception if data file is not open.           (*)
    Addressing problem report #1942.
  o G4LevelReader: always create G4LevelManager for stable isotopes
    including light stable p, d, t, He3, He4.
  o G4LevelManager: removed obsolete method.
  o G4NuclearLevelData: synchronise the list of isotopes with the 
    current set of data files; extra rare isotopes are allowed; 
    Z max is extended from 102 to 117.
  o G4PhotonEvaporation: perform transition to the ground state of an        (*)
    isotope if the floating level has zero excitation energy.
    Addressing problem report #1950.
  o G4VEmissionProbability: added private method for general treatment 
    of PDF functions
  o G4EvaporationProbability, G4CompetitiveFission, G4CompetitiveFission,
    G4GEMProbability: modified according to updated base class.
  o G4EvaporationChannel: make choice of minimal evaporation energy
    Z-dependent.
  o G4FermiFragmentsPoolVI: improved handling of internal data structure.
  o G4LevelReader, G4FermiFragmentsPoolVI: fixed Coverity defects.
- models/em_dissociation (hadr-emd-V10-03-00)
  o G4EMDissociation: removed unnecessary explicit instantiation of
    FermiBreakUp, Evaporation and MultiFragmentation models.
- models/particle_hp (hadr-hpp-V10-03-00)                                    (*)
  o Fixed minor inconsistency between documentation and code.
- models/parton_string/hadronization (had-hadronization-V10-03-05)
  o G4LundStringFragmentation: fixed minor memory leaks.
- models/radioactive_decay (radioactive_decay-V10-03-06)                     (*)
  o G4RadioactiveDecay::DecayIt(): added statement to propagate weight of
    parent track. Addressing problem report #1946.
- util (hadr-util-V10-03-00)                                                 (*)
  o G4GHEKinematicsVector: fixed case of variable shadowing.

processes/optical                                op-V10-03-01
-----------------
- Added DAVIS model for optical physics.

run                                              run-V10-03-06
---
- G4WorkerThread: use CleanUpAndDestroyAllWorkspaces() from workspace pools
  in DestroyGeometryAndPhysicsVector(). Minor code cleanup.
- Delete G4TransportationManager, G4FieldManagerStore, G4GeometryManager and
  G4PathFinder singletons in G4RunManagerKernel, clearing static leaks at exit.
- G4RunManagerKernel: removed unnecessary warning message.                   (*)
- G4RunManager: notify visualization-manager when world volune is
  re-initialized.

data sets:
---------
- G4RealSurface-2.0:
  o Added data for support of DAVIS model.

examples                                         examples-V10-03-03
--------
- Updated documentation and reference outputs.
- advanced/air_shower (air_shower-V10-03-00)                                 (*)
  o Updated setup for visualization in main() and Visualisation.mac.
- advanced/hadrontherapy (hadrontherapy-V10-03-05)
  o Corrected carbon beam line geometry and added new modulators.
  o Corrected definition of geometry region.
  o Added cuts definition in PhysicsList.
- advanced/microbeam (microbeam-V10-03-01)
  o PhysicsList, PhysicsListMessenger: removed obsolete way of cut definition.
  o DetectorConstruction: thread safe definition of magnetic field.
  o SteppingAction: simplified implementation, added check on alpha leaving
    the world volume.
- basic/B5 (exampleB5-V10-03-00)
  o Removed use of G4AutoDelete utility for thread-local magnetic-field and
    its manager, since not necessary as now automatically deleted by kernel.
- extended/biasing/B01 (B01-V10-03-00)                                       (*)
- extended/biasing/B02 (B02-V10-03-00)                                       (*)
  o Removed unnecessary clearing of sampling.
- extended/biasing/B03 (B03-V10-03-01)                                       (*)
  o B03PhysicsList: removed obsolete unnecessary instantiation of 
    de-excitation sub-models.
  o Removed unnecessary clearing of sampling.
- extended/electromagnetic/TestEm5 (testem5-V10-03-03)
  o DetectorConstruction: corrected definition of element Chrome.
- extended/eventgenerator/HepMC/MCTruth (mctruthex-V10-03-00)                (*)
  o Fixed typo in initialisation.
- extended/g3tog4 (g3tog4Tests-V10-03-01)                                    (*)
  o Fixed linking problem for static build.
- extended/medical/dna/neuron (neuron-V10-03-00)
  o New example allowing for the modelling of neuron cell irradiation,
    including physical, physico-chemical and chemical processes (e.g.
    production of oxidative radical species in the vicinity of neurons).
    It uses realistic geometrical models of neurons generated from a
    standardized SWC file representing neuron morphology.
- extended/medical/dna/slowing (slowing-V10-03-01)
  o New example showing how to simulate slowing down spectra for electrons
    in liquid water using the Geant4-DNA physics processes and models.
- extended/medical/dna/spower (spower-V10-03-00)
  o New example showing how to calculate stopping power of particles 
    in liquid water using the Geant4-DNA physics processes and models.
- extended/medical/fanoCavity (fano-V10-03-01)
  o PhysListEmStandard_GS, PhysListEmStandard_SS, PhysListEmStandard_WVI,
    PhysListEmStandard_option3: use the same step function as in physics_list
    factory for corresponding constructors, ensure that step function
    parameters may be redefined by UI commands.
  o Switch to NIST material description (keeping material densities defined
    in previous version).
  o Set default thread number to 2 instead of maximum number of cores.
- extended/persistency/gdml/G01 (G01-V10-03-01)                              (*)
  o Updated setup for visualization in main program.
  o Added missing gdml files to CMake installation script.
- extended/persistency/gdml/G02 (G02-V10-03-00)                              (*)
- extended/persistency/gdml/G03 (G03-V10-03-00)                              (*)
  o Updated setup for visualization in main program.
- extended/radioactivedecay/rdecay01 (rdecay01-V10-03-06)
  o PhysicsList: use time limit from G4IonTable for de-excitation module.
  o TrackingAction: simplified way to get mean-life.

tests                                            tests-V10-03-03
-----
- Updated reference outputs and tools.
- tests/test01 (test01-V10-03-01)
  o Added destructor to DetectorMessenger PrimaryGeneratorMessenger.
  o Corrected PrimaryGeneratoAction for retrivial of world-volume size and
    avoid double creation of detector-construction.
  o Corrected initialisation of default setup, moving from DetectorMessenger
    to DetectorConstruction constructor.
  o Use G4AutoDelete for deleting assembly structures in DetectorConstruction
    and further cleanup for leaks at initialisation.
  o Fixed input macros to take into account default setup.
- tests/test03 (test03-V10-03-00)
  o Added test of GetHnId(), GetHnName() functions.
- tests/test04 (test04-V10-03-00)
  o Allow to use local data via G4PARTICLEHPDATA path; if not defined in
    environment download the data. Corrected download URL.
- tests/test13 (test13-V10-03-00)
  o Tst13PhysicsList: removed obsolete instantiation of de-excitation
    module, use a standard one instead.
- tests/test24 (test24-V10-03-00)
  o Tst24PhysicsList: removed unused headers.
- tests/test25 (test25-V10-03-00)
- tests/test28 (test28-V10-03-00)
  o PhysicsList: removed incorrect instantiation of de-excitation sub-models.
- tests/test61 (test61-V10-03-00)
  o Tst13PhysicsList: removed obsolete unused headers.
